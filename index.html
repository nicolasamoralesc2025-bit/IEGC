<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de la Serpiente Calavera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Usamos la fuente Inter por defecto */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Fondo muy oscuro */
            color: #f0f0f0; /* Texto claro */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .game-container {
            background-color: #000000; /* Fondo negro puro */
            border: 4px solid #4a044e; /* Borde morado oscuro */
            box-shadow: 0 0 30px rgba(74, 4, 78, 0.8), inset 0 0 15px rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px;
        }

        #gameCanvas {
            display: block;
            background-color: #000000;
            border-radius: 8px;
        }

        .controls-panel {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .control-button {
            background-color: #3b0764; /* Morado oscuro para botones */
            color: #c4b5fd; /* Texto morado claro */
            padding: 8px 16px;
            border-radius: 8px;
            border: 2px solid #6d28d9;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px #2e054f;
        }

        .control-button:hover {
            background-color: #4c1d95;
            box-shadow: 0 2px #2e054f;
            transform: translateY(2px);
        }

        .info-card {
            background-color: #262626;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        /* Estilo para el mensaje de juego terminado */
        #messageBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            border: 3px solid #ef4444; /* Rojo de terror */
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.5);
            z-index: 100;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1 class="text-4xl font-extrabold mb-4 text-white">Serpiente Calavera üíÄ</h1>
    <p class="text-lg mb-6 text-gray-400">¬°Recoge todas las calaveras que puedas!</p>

    <div class="info-card">
        <p class="text-xl font-semibold mb-2">Puntuaci√≥n: <span id="score" class="text-lime-400">0</span></p>
        <p class="text-sm text-gray-500">Usa las teclas de flecha (‚Üë ‚Üì ‚Üê ‚Üí) para mover la serpiente.</p>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>

    <div id="messageBox" class="hidden">
        <h2 class="text-3xl font-bold text-red-500 mb-4">¬°Juego Terminado!</h2>
        <p class="text-xl mb-4">Tu puntuaci√≥n final es: <span id="finalScore" class="font-bold text-lime-400">0</span></p>
        <button id="restartButton" class="control-button">Volver a Jugar</button>
    </div>

    <script>
        // Configuraci√≥n inicial del juego
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const messageBox = document.getElementById('messageBox');
        const finalScoreDisplay = document.getElementById('finalScore');
        const restartButton = document.getElementById('restartButton');

        // Dimensiones del juego
        const TILE_SIZE = 20; // Tama√±o de cada segmento de la serpiente/calavera
        const COLS = canvas.width / TILE_SIZE;
        const ROWS = canvas.height / TILE_SIZE;

        // Variables del juego
        let snake = [];
        let food = {}; // La calavera
        let dx = 0; // Direcci√≥n x (1, -1, 0)
        let dy = 0; // Direcci√≥n y (1, -1, 0)
        let score = 0;
        let gameLoopInterval;
        let isPaused = false;
        let changingDirection = false; // Bandera para evitar giros dobles

        /**
         * Inicializa o reinicia el estado del juego.
         */
        function resetGame() {
            // Posici√≥n inicial de la serpiente (en el centro)
            snake = [{ x: Math.floor(COLS / 2), y: Math.floor(ROWS / 2) }];
            dx = 1;
            dy = 0;
            score = 0;
            scoreDisplay.textContent = score;
            isPaused = false;
            changingDirection = false;
            messageBox.classList.add('hidden');

            // Generar la primera calavera
            spawnFood();

            // Iniciar el bucle del juego (velocidad: 150ms)
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 150);
        }

        /**
         * Genera una nueva posici√≥n para la calavera (comida).
         */
        function spawnFood() {
            let newFoodPos;
            do {
                newFoodPos = {
                    x: Math.floor(Math.random() * COLS),
                    y: Math.floor(Math.random() * ROWS)
                };
            } while (snake.some(segment => segment.x === newFoodPos.x && segment.y === newFoodPos.y)); // Asegura que no aparezca sobre la serpiente

            food = newFoodPos;
        }

        /**
         * Dibuja todos los elementos en el canvas.
         */
        function draw() {
            // 1. Fondo negro del canvas
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Dibuja la calavera (comida)
            // Usamos un emoji para el efecto de calavera
            ctx.font = `${TILE_SIZE}px sans-serif`;
            // Centra el emoji en la celda
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üíÄ', food.x * TILE_SIZE + TILE_SIZE / 2, food.y * TILE_SIZE + TILE_SIZE / 2);

            // 3. Dibuja la serpiente
            snake.forEach((segment, index) => {
                // El primer segmento (cabeza) es un color diferente
                if (index === 0) {
                    ctx.fillStyle = '#10b981'; // Verde turquesa para la cabeza
                } else {
                    ctx.fillStyle = '#65a30d'; // Verde lima para el cuerpo
                }
                
                // Dibuja el segmento con bordes redondeados
                drawRoundedRect(segment.x * TILE_SIZE, segment.y * TILE_SIZE, TILE_SIZE, TILE_SIZE, 3);
            });
        }
        
        /**
         * Helper function para dibujar rect√°ngulos redondeados
         */
        function drawRoundedRect(x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }

        /**
         * Actualiza el estado del juego (movimiento, colisiones, comida).
         */
        function update() {
            if (isPaused) return;

            // 1. Mover la cabeza
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // 2. Colisiones
            // a) Paredes
            if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) {
                gameOver();
                return;
            }

            // b) Con el cuerpo
            if (snake.slice(1).some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            // 3. Insertar la nueva cabeza
            snake.unshift(head);

            // 4. Comprobar si come la calavera
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.textContent = score;
                spawnFood();
            } else {
                // Si no come, quita la cola (movimiento normal)
                snake.pop();
            }

            // Permitir cambiar de direcci√≥n nuevamente
            changingDirection = false;
        }

        /**
         * Bucle principal del juego.
         */
        function gameLoop() {
            update();
            draw();
        }

        /**
         * Muestra el mensaje de juego terminado y detiene el juego.
         */
        function gameOver() {
            clearInterval(gameLoopInterval);
            isPaused = true;
            finalScoreDisplay.textContent = score;
            messageBox.classList.remove('hidden');
        }

        /**
         * Maneja la entrada del teclado para cambiar la direcci√≥n.
         */
        function handleKeydown(event) {
            if (changingDirection) return;
            changingDirection = true;

            const keyPressed = event.key;
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingLeft = dx === -1;
            const goingRight = dx === 1;

            switch (keyPressed) {
                case 'ArrowUp':
                    if (!goingDown) { dx = 0; dy = -1; }
                    break;
                case 'ArrowDown':
                    if (!goingUp) { dx = 0; dy = 1; }
                    break;
                case 'ArrowLeft':
                    if (!goingRight) { dx = -1; dy = 0; }
                    break;
                case 'ArrowRight':
                    if (!goingLeft) { dx = 1; dy = 0; }
                    break;
                default:
                    changingDirection = false; // Si no es una tecla de direcci√≥n, permitir otro intento
                    return;
            }
            event.preventDefault(); // Evita el desplazamiento de la p√°gina
        }

        // --- Event Listeners ---
        document.addEventListener('keydown', handleKeydown);
        restartButton.addEventListener('click', resetGame);

        // Iniciar el juego al cargar
        resetGame();

    </script>
</body>
</html>
